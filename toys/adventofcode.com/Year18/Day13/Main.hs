{-# LANGUAGE TupleSections #-}
{-# LANGUAGE UnboxedTuples #-}
-- solution for
-- http://adventofcode.com/2018/day/13

module Main where

import           Data.Maybe
import           Data.Map.Strict (Map)
import qualified Data.Map.Strict as M
import           Data.List
import           Util.Main1 (main12)
import           Control.Arrow (first, second)
-- import Debug.Trace

import Control.Monad.State.Strict
import Control.Monad.Except

-- ----------------------------------------

main :: IO ()
main = do
  main12 "2018-13"
    inp captcha1
    inp captcha2

captcha1 :: String -> String
captcha1 = toString . solve1 . fromString

captcha2 :: String -> String
captcha2 = toString . solve2 . fromString

-- ----------------------------------------

data Street     = H | V | BS | SL | CX | N
                deriving (Eq, Show)

data Dir        = DRight | DDown | DLeft | DUp | Crash
                deriving (Eq, Show)

data Turn       = TurnLeft | Straight | TurnRight
                deriving (Eq, Show)

type Point      = (Int, Int)
type StreetMap  = Map Point Street
type CartMap    = Map Point (Dir, Turn)
type Tick       = Int
type Carts      = (Tick, (CartMap, StreetMap))

-- ----------------------------------------

type Action     = ExceptT Point (State Carts)

runAction :: Action a -> Carts -> (Either Point a, Carts)
runAction action carts0 =
  runState (runExceptT action) carts0

incrTicks :: Action ()
incrTicks = modify (first (+ 1))

getTicks :: Action Tick
getTicks = gets fst

getStreet :: Point -> Action Street
getStreet p = gets (fromMaybe N . M.lookup p . snd . snd)

getDir :: Point -> Action (Maybe (Dir, Turn))
getDir p = gets (M.lookup p . fst . snd)

cartOnStreet :: Point -> Action Bool
cartOnStreet p = gets (isJust . M.lookup p . fst . snd)

getCarts :: Action [Point]
getCarts = gets (M.keys . fst . snd)

moveCartTo :: Point -> (Dir, Turn) -> Action ()
moveCartTo p dt = modify (second (first (M.insert p dt)))

removeCartAt :: Point -> Action ()
removeCartAt p = modify (second (first (M.delete p)))

tick :: Action ()
tick = do
  incrTicks
  cs <- getCarts
  mapM_ (moveC' stopAtFstCrash) cs

tick' :: Int -> Action ()
tick' 0 = return ()
tick' n = tick >> tick' (n - 1)

tick2 :: Action ()
tick2 = do
  cs <- getCarts
  case cs of
    _ : _ : _ -> do -- trace ("cars left: " ++ show ( cs)) $
                    incrTicks
                    mapM_ (moveC' removeCartAt) cs
    p1 : []   -> throwError p1       -- last cart
    []        -> throwError (-1, -1) -- no car left, should not occur


moveC' :: (Point -> Action ()) -> Point -> Action ()
moveC' handleCrash p =
  getDir p >>= maybe (return ()) move
  where
    move (d, t) = do
      let p'  =  moveP d p         -- calc next cart position
      removeCartAt p
      crashed <- cartOnStreet p'   -- check for crash
      if crashed
        then handleCrash p'
        else do
          s       <- getStreet p'  -- no crash: calc new dir and new turn
          let t'  =  calcTurn s t
          let d'  =  calcDir s t d
          moveCartTo p' (d', t')   -- update cart state with new pos, dir and turn

stopAtFstCrash :: Point -> Action ()
stopAtFstCrash = throwError

-- ----------------------------------------

calcDir :: Street -> Turn -> Dir -> Dir
calcDir CX t d = cxTurn t d
calcDir s  _ d = turn s d

cxTurn :: Turn -> Dir -> Dir
cxTurn TurnLeft  DRight = DUp
cxTurn TurnLeft  DUp    = DLeft
cxTurn TurnLeft  DLeft  = DDown
cxTurn TurnLeft  DDown  = DRight

cxTurn TurnRight  DRight = DDown
cxTurn TurnRight  DUp    = DRight
cxTurn TurnRight  DLeft  = DUp
cxTurn TurnRight  DDown  = DLeft

cxTurn _         d      = d

turn :: Street -> Dir -> Dir
turn BS DRight = DDown
turn BS DDown  = DRight
turn BS DUp    = DLeft
turn BS DLeft  = DUp

turn SL DRight = DUp
turn SL DUp    = DRight
turn SL DDown  = DLeft
turn SL DLeft  = DDown

turn _  d      = d

calcTurn :: Street -> Turn -> Turn
calcTurn CX t = nextTurn t
calcTurn _  t =          t

nextTurn :: Turn -> Turn
nextTurn TurnLeft  = Straight
nextTurn Straight  = TurnRight
nextTurn TurnRight = TurnLeft


moveP :: Dir -> Point -> Point
moveP DRight  (x, y) = (x + 1, y    )
moveP DLeft   (x, y) = (x - 1, y    )
moveP DUp     (x, y) = (x    , y - 1)
moveP DDown   (x, y) = (x    , y + 1)
moveP Crash   p      = p

-- ----------------------------------------

solve1 :: Carts -> Point
solve1 = either id (const (-1,-1)) . fst . runAction (forever tick)

solve2 :: Carts -> Point
solve2 = either id (const (-1,-1)) . fst . runAction (forever tick2)

-- ----------------------------------------

toString :: Point -> String
toString (x, y) = show x ++ "," ++ show y

fromString :: String -> Carts
fromString = (0,) . parseLines . lines

parseLines :: [String] -> (CartMap, StreetMap)
parseLines =
  merges . zipWith parseLine [0..]
  where
    parseLine :: Int -> String -> (CartMap, StreetMap)
    parseLine y =
      merges . zipWith parseChar [0..]
      where
        parseChar :: Int -> Char -> (CartMap, StreetMap)
        parseChar x c = case c of
          '/'  -> sm1 SL
          '\\' -> sm1 BS
          '-'  -> sm1 H
          '|'  -> sm1 V
          '+'  -> sm1 CX
          '>'  -> cm1 DRight
          '<'  -> cm1 DLeft
          '^'  -> cm1 DUp
          'v'  -> cm1 DDown
          _    ->  m0
          where
            cm1 d  = (M.singleton p (d, TurnLeft), M.empty         )
            sm1 st = (M.empty                    , M.singleton p st)
            p = (x, y)

m0 :: (CartMap, StreetMap)
m0 = (M.empty, M.empty)

merge :: (CartMap, StreetMap) -> (CartMap, StreetMap) -> (CartMap, StreetMap)
merge (c1, s1) (c2, s2) =
  (c1 `M.union` c2, s1 `M.union` s2)

merges :: [(CartMap, StreetMap)] -> (CartMap, StreetMap)
merges = foldl' merge m0

ex :: String
ex = unlines
  [ "/->-\\        "
  , "|   |  /----\\"
  , "| /-+--+-\\  |"
  , "| | |  | v  |"
  , "\\-+-/  \\-+--/"
  , "\\------/   "
  ]

inp' :: IO String
inp' = readFile "Year18/Day13/day13.txt"

inp :: String
inp = "                      /---------------------\\           /----------------<---------------------------------------------------------------------\\\n                      |                     |           |         /---------------------------\\                                                |\n              /-------+---------------------+-----------+---------+---------------------------+------\\                                         |\n   /----------+-------+---------------------+---\\      /+---------+---------------------------+------+------\\                                  |\n /-+----------+-------+---------------------+---+------++---------+-------------------------\\ |      |      |                                  |\n | |          |       |  /------------------+---+------++---------+-----\\                   | | /----+------+---------------------------\\      |\n | |   /------+-------+--+------------------+---+-\\    ||         |     |              /----+-+-+----+------+----------------\\          |      |\n | |   |      | /-----+--+------------------+---+-+----++---------+-----+--------------+----+-+-+----+---\\  |                |          |      |\n | |   |      | |    /+--+--------------\\   |   | |    ||    /----+-----+--------------+----+-+-+----+---+--+----------------+---------\\|      |\n | |   |      | |    ||  |              |   |   | |    ||    |    |     |              |    | | |    |   |  |                |         ||      |\n | |   |      | |    ||  |      /-------+---+-\\ | |    ||    |    |     |              |    | | |    |   |  |        /-------+---------++------+---\\\n | |   |      | |    ||  |      |       |   | | | |    ||    |    |     |     /--------+----+-+-+----+---+\\ |        |       |         ||      |   |\n | |   |      | |    ||  |      |       |   | | | |    ||    |/---+-----+\\    |        |    | | |    |   || |        |       |         ||      |   |\n | |   |    /-+-+----++--+------+-------+---+-+-+-+----++----++---+-----++--->+--------+----+-+-+----+---++-+-----\\  |       |         ||      |   |\n | |   |    | | |   /++--+------+-------+---+-+-+-+----++----++---+-----++----+--------+----+-+-+----+---++-+-----+--+-------+-\\       ||      |   |\n | |  /+----+-+-+---+++--+------+-------+---+-+-+-+----++-\\  ||   |     ||    |        |    | | |    |   || |     |  |       | |       ||      |   |\n | |  ||    | | |   |||  |      |       |   | | | |    || | /++---+-----++----+--------+----+-+-+-\\  |   || |     |  |       | |       ||      |   |\n | |  ||    |/+-+---+++--+------+-------+---+-+-+-+----++-+-+++---+\\  /-++----+--\\     |    | | | |  |   || |     |  |       | |/------++--\\   |   |\n | |  ||    ||| |/--+++--+------+-------+---+-+-+-+----++\\| |||   ||  | ||    |  | /---+----+-+-+-+--+---++-+----\\|  |       | ||      ||  |   |   |\n | |  ||    ||| ||  |||  |/-----+-------+---+-+-+-+----++++-+++---++--+-++----+--+-+---+----+-+-+-+--+---++-+----++--+-------+-++---\\  ||  |   |   |\n | |  ||    ||| ||  |\\+--++-----+-------/   | | | |    |||| |||   v|  | ||    |  | |   |    | | | |  |/--++-+----++--+-------+-++---+--++--+---+--\\|\n/+-+--++----+++-++--+-+--++-----+-----------+-+-+-+----++++-+++---++--+-++----+--+-+-\\ \\----+-+-+-+--++--++-+----++--+-------/ ||   |  ||  |   |  ||\n|| | /++----+++-++--+-+--++-----+-----------+-+-+-+----++++-+++---++--+-++---\\|  | | |      | | | |  ||  || |    ||  |         ||   |  ||  |   |  ||\n|| | |||    ||| ||  | |  ||     |           | | | |/---++++-+++---++--+-++---++--+-+-+------+-+-+-+--++--++-+----++--+---------++--\\|  ||  |   |  ||\n|| | |||/---+++-++--+-+--++-----+-----------+-+-+-++---++++-+++---++--+-++---++--+-+-+---\\  | | | |  ||  || |    ||  |         ||  ||  ||  |   |  ||\n|| | ||||   ||| ||  | |  ||     |           | | | ||   |||| |||   ||  | ||/--++--+-+-+---+--+-+\\| |  ||  || |    ||  |         ||  ||  ||  |   |  ||\n|| | ||||   ||| || /+-+--++-----+-----------+-+-+-++---++++-+++---++--+-+++--++--+-+-+---+--+-+++-+--++--++-+----++--+-------\\ ||  ||  ||  |   |  ||\n|| | ||||   ||| \\+-++-+--++-----+-----------+-+-+-++---++++-+++---++--+-+++--++--+-+-+---+--+-+++-+--++--/| |    ||  \\-------+-++--++--++--+---+--+/\n|| | ||||   |||  |/++-+--++-----+-----------+-+-+-++---++++-+++---++--+-+++\\ ||  | | |   |  | ||| |  ||   | |    ||          | ||  ||  ||  |   |  |\n|| | ||||   |||  |||| |  ||     |           | | | ||   |||| |||   ||  | |||| ||  | | |   |  | ||| |  ||   | |    ||          | ||  ||  ||  |   |  |\n|| |/++++---+++--++++-+--++---\\ |           | | | ||   |||| |||   ||/-+-++++-++--+-+-+---+--+-+++-+--++---+-+----++----------+-++--++--++--+---+--+\\\n|| ||||||   |||  |||| |  ||   | |           | | | ||   |||| |\\+---+++-+-++++-++--+-+-+---+--+-+++-+--++---+-+----++----------+-++--++--/|  |   |  ||\n|| ||||||   |||  |||| |  ||   | |  /--------+-+-+-++---++++-+-+---+++-+-++++-++--+-+-+---+-\\| ||| |  ||   | |    ||          | ||  ||   |  |   |  ||\n|| ||||||   |||  |||| | /++---+-+--+--------+-+-+-++---++++-+-+---+++-+-++++-++--+-+-+---+-++-+++-+--++-\\ | |    || /--------+-++--++---+--+\\  |  ||\n|| ||||||   |||  |||| | |||   | |  |   /----+-+-+-++---++++-+-+---+++-+-++++-++--+-+-+---+-++-+++-+--++-+-+-+----++-+--------+-++--++---+--++--+-\\||\n|| ||||||   |||  |||| | |||   | |  |   |    | | | ||  /++++-+-+--\\||| | |||| ||  |/+-+---+-++-+++-+--++-+-+-+----++-+--------+-++--++---+--++-\\| |||\n|| ||||||   |||  |||| | |||  /+-+--+---+----+-+-+-++--+++++-+-+--++++-+-++++-++--+++-+---+-++-+++-+--++-+-+-+----++-+--\\     | ||  ||   |  || || |||\n|| |||||| /-+++--++++-+-+++--++-+--+---+----+-+\\| ||  ||||| | |  |||| | |||| ||  ||| |   | || ||| |  || | | |    || |  |   /-+-++--++---+\\ || || |||\n|| |||||| | |||  |||| \\-+++--++-+--+---+----/ ||| ||  ||||| | |  |||| | |||| ||  ||| |   | || ||| |  || | | |    || |  |   | | ||  ||   || || || |||\n|| ||||\\+-+-+++--++++---+++--++-+--+---+>-----+++-/|  ||||| | |  |||\\-+-++++-++--+++-+---+-++-+++-+--++-+-+-+----++-+--+---+-+-++--++---++-++-++-++/\n|| |||| | | |||  ||||   |||  || |  |   |/-----+++--+--+++++-+-+--+++--+-++++-++--+++-+---+-++-+++-+--++-+-+-+-\\  || |  |   | | ||  ||   || || || ||\n|| |||| | | |||  |\\++---+++--++-+--+---++-----+++--+--+++++-+-+--+++--+-+++//++--+++-+---+-++-+++-+--++-+-+-+-+--++-+--+---+\\| ||  ||   || || || ||\n|| |||| | | |||  | |\\---+++--++-+--+---++-----+++--+--+++++-+-+--+++--+>+++-+++--+++-+---+-++-+++-+--++-+-+-+-+--++-+--+---+++-/|  ||   || || || ||\n|| |||| | | |||  | |    |||  || |  | /-++-----+++--+--+++++-+-+--+++--+-+++-+++--+++-+---+-++-+++-+--++-+-+-+-+--++-+--+---+++--+--++-<-++-++-++\\||\n|| |||\\-+-+-+++--+-+----+++--++-+--+-+-++-----+++--+--++++/ | |  |||  | ||| |||  ||| |   | || ||| |  || |/+-+-+--++-+--+---+++--+--++---++-++-+++++\\\n|| |||  | | |||  | |    |||  || |  | | ||     |||  |  ||||  \\-+--+++--+-+++-+++--+++-+---+-++-+++-/  || ||| | |  || |  |   |||  |  ||   || || ||||||\n|| |||  | | |||  | |    |||  || |  | | ||/----+++--+--++++----+\\ |||  | ||| |||  |||/+---+-++-+++----++-+++-+-+--++-+--+---+++--+--++--\\|| || ||||||\n|| |||  | | |||  | |    |||  || |  |/+-+++----+++--+--++++----++-+++--+-+++-+++--+++++---+-++-+++----++-+++-+-+--++-+--+---+++-\\|  ||  ||| || ||||||\n|| \\++--+-+-+++--+-+----+++--++-+--+++-+++----++/  |  ||||    || |||  \\-+++-+++--/||||   | || |||    || ||| | |  || |  |   ||| ||  ||  ||| || ||||||\n||  ||  | | |||  | |    |||  || |  ||| |||    ||   |  ||||    || |||    ||| ||\\---++++---+-++-+++----++-++/ | |  || |  |   ||| ||  ||  ||| || ||||||\n||  ||  | | |||  | |    |||  || |  ||| |||    ||   |  ||||    \\+-+++----+/| \\+----++++---+-++-+++----++-++--+-+--++-+--+---+/| ||  ||  ||| || ||||||\n||  || /+-+-+++--+-+----+++--++-+--+++-+++----++---+--++++-----+-+++----+-+--+----++++---+\\|| |||    || ||  | |  || \\--+---+-+-++--++--+++-+/ ||||||\n||  || || | |||  | |   /+++--++-+--+++-+++----++---+--++++-----+-+++----+-+--+----++++---++++-+++----++-++--+-+--++--\\ |   | | ||  ||  ||| |  ||||||\n||  || || | |||  | |   ||||  || |  ||| |||    ||   |  ||||     | |\\+----+-+--+----++++---++++-/||    || ||  | |  ||  | |   | | ||  ||  ||| |  ||||||\n||  || || | |||  | |  /++++--++-+--+++-+++----++---+--++++-----+-+-+----+-+--+----++++---++++--++----++-++--+-+--++--+-+---+-+-++-\\||  ||| |  ||||||\n||  || || | |||  | |  |||||  || |  ||| |||    ||   |  ||||     | | |    | |  |    ||||   |||| /++----++-++--+-+--++--+\\|   |/+-++-+++\\ ||| |  ||||||\n||  || || | |||  | |  |||||  || |  ||| |||    ||   |/-++++-----+-+-+----+-+--+----++++---++++-+++\\   || ||  | |  ||  |||   ||| || |||| ||| |  ||||||\n||  || || | |||  | | /+++++--++-+--+++<+++----++---++-++++-----+-+-+----+-+--+----++++---++++-++++---++-++--+\\|  ||  |||   ||| || |||| ||| |  ||||||\n||  || || | |||  | | ||||||  || |  |\\+-+++----++---++-++++-----+-+-+----+-+--+----++++---++++-++++---++-++--+++--++--+++---+++-/| |||| ||| |  ||||||\n||  || || | |||  | | |||\\++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++++---++++-++++---++-/|  |||  ||  |||   |||  | |||| ||| |  |^||||\n||  || || | |||  | |/+++-++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++++\\  |||| ||||   |\\--+--+++--++--+++---+++--+-++++-+++-+--++++/|\n||  || || | |||  | ||||| ||  || |  | | |||    ||   || ||||     | | |    | |  |    ||\\++--++++-++++---+---+--+++--++--+++---+++--+-++++-/|| |  |||| |\n||  || || | |||  | ||||| ||  || |  | | |||    ||   || ||||     | | |    | |  |    || ||  |||| ||||   |   |  |||  ||  |||   |||  | ||||  || |  |||| |\n||  || || | \\++--+-+++++-++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++-++--++++-++++---+---+--+++--+/  |||   |||  | ||||  || |  |||| |\n||  || || |  ||  | ||||| ||  || |  | | |||    ||   || ||||     | | |    | |  |    || ||  |||| ||||   |   |  |||  |   |||   |||  | ||||  || |  |||| |\n||  ||/++-+--++--+-+++++-++--++-+--+-+-+++----++---++-++++-----+-+-+----+-+--+----++-++\\ |||| ||||   |   |  |||  |   |||   |||  | ||||  || |  |||| |\n||  \\++++-+--++--+-+++++-++--+/ |  | | ||| /--++---++-++++-----+-+-+----+-+--+----++-+++-++++-++++>--+---+--+++--+---+++---+++--+\\||||  || |  |||| |\n||   |||| |  ||  | ||||| |\\--+--+--+-+-+++-+--++---++-++++-----+-+-+----+-+--+----++-+++-++++-++++---+---+--+++--+---+++---+++--++++/|  || |  |||| |\n||   |||| |  ||  | ||||| |   |  |  | | ||\\-+--++---++-++++-----/ | |    |/+--+----++-+++\\|||| ||||   |/--+--+++--+---+++---+++--++++-+--++-+-\\|||| |\n||   |||| |  ||  | ||||| |   |  |  | | ||  |/-++---++-++++-------+-+----+++--+----++-++++++++-++++---++--+--+++--+---+++---+++--++++-+--++\\| ||||| |\n||   |||| |  ||  | ||||| | /-+--+--+-+-++--++-++---++-++++-------+-+----+++--+----++-++++++++-++++---++--+--+++\\ |   |||   |||  |||| |  |||| ||||| |\n|\\---++++-+--++--+-+++++-+-+-+--+--+-+-++--++-++---++-++++-------+-+----+++--+----++-+++++++/ ||||   ||  |  |||| |   |||   |||  |||| |  |||| ||||| |\n|    |||\\-+--++--+-+++++-+-+-+--+--+-+-++--++-++---++-++++-------+-+----+++--+----++-++++/||  ||||   ||  |  |||| |   |||   |||  |||| |  |||| ||||| |\n|    |||/-+--++--+-+++++-+-+-+--+--+-+-++--++-++---++-++++-------+-+-\\  |||  |    || |||| ||  ||||   ||  |  |||| |   |||   |||  |||| |  |||| ||||| |\n|    |||| |  ||  | ||||| | | |  |  | | ||  || ||   |\\-++++-------+-+-+--+++--+----++-++++-++--+++/   ||  |  |||| |   |||   |||  \\+++-+--+++/ ||||| |\n|    |||| |  ||  | ||||| | | |/-+--+-+-++--++-++---+--++++-------+-+-+--+++--+----++-++++-++--+++----++--+--++++\\|   |||   |||   ||| |  |||  ||||| |\n|    |||| |  ||  | ||||| | | || |  | | ||  || || /-+--++++-------+-+-+--+++--+--\\ || |||| ||  |||    ||  |  ||||||   |||   |||   ||| |  |||  ||||| |\n|    |||| |  ||  | ||||| \\-+-++-+--+-+-++--++-++-+-+--++++-------+-+-+--/||  |  | || |||| ||  |||    ||  |  ||||||   |||   |||   ||| |  |||  ||||| |\n|    |||| |  ||  | |||||   | || |  | | ||  || || | |  |||| /-----+-+-+---++--+--+-++-++++-++--+++----++--+--++++++---+++---+++\\  ||| |  |||  ||||| |\n|    |||| |  \\+--+-+++++---+-++-+--+-+-++--++-++-+-+--++++-+-----+-/ |   ||  |  | || |||| ||  |||   /++--+--++++++\\  |||   |||| /+++-+--+++\\ ||||| |\n|    |||| \\---+--+-+++++---+-++-+--+-+-++--++-+/ v |  |\\++-+-----+---+---++--+--+-++-++++-++--+++---+++--+--/||||||  |||   |||| |||| |  |||| ||||| |\n|    ||||  /--+--+-+++++--\\|/++-+--+-+-++--++-+--+-+--+-++-+-----+---+---++--+--+-++-++++-++--+++---+++--+\\  ||||||  |||   |||| |||| |  |||| ||||| |\n|    ||||  |  | /+-+++++--+++++-+--+-+-++--++-+--+-+--+-++-+-----+---+---++-\\|  | || |||| ||  |||   |||/-++--++++++-\\|||   |||| |||| |  |||| ||||| |\n|    ||||  |  | || |||||  ||||| |  | | ||  || |  | |  | || |/----+---+---++-++--+-++-++++-++--+++---++++-++--++++++-++++\\  |||| |||| |  |||| ||||| |\n\\----++++--+--+-++-+++++--+++++-+--+-+-++--++-+--+-+--+-++-++----+---+---++-++--+-++-/||| ||  |||   |||| ||  |||||| |||||  |||| |||| |  |||| ||||| |\n    /++++--+--+-++-+++++\\ |||\\+-+--+-+-++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++++++-+++/|  |||| |||| |  |||| ||||| |\n    |||||/-+--+-++-++++++-+++-+-+-\\| \\-++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++++++-+++-+--++++-++++-+--++++-+++/| |\n    |||||| |  | || |||||| |\\+-+<+-++---++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++/||| ||| |  |||| |||| |  |||| ||| | |\n    |||||| |  | || |||||| | | \\-+-++---++--++-+--+-+--+-++-++----+---+---++-++--+-++--+++-++--+++---++++-++--++-/|| ||| |  |||| |||| |  |||| ||| | |\n    |||||| |  | || |||||| | |   | ||   ||  || |  \\-+--+-++-++----+---+---++-++--/ ||  ||| ||  |||   |||| ||  ||  || ||| |  |||| |||| |  |||| ||| | |\n    |||||| |  | || |||\\++-+-+---+-++---++--++-+----+--+-++-++----+---+---++-++----++--+++-++--+++---++++-++--++--++-+++-+--++++-++/| |  |||| ||| | |\n    |||||| |  |/++-+++-++-+-+---+-++---++--++-+----+--+-++-++----+---+---++-++----++--+++-++\\ |||   |||| ||  ||  || ||| |  |||| || | |  |||| ||| | |\n    |||||| |  |||| ||| || | |   | |\\---++--++-+----+--+-++-++----+---+---++-++----++--+++-+/| |||   |||| ||  ||  || ||| |  |||| || | |  |||| ||| | |\n    |||||| |  |||| ||| || | |   | |    ||  \\+-+----+--+-++-++----+---+---++-++----++--+++-+-+-+++---++++-++--++--++-+++-+--++++-+/ | |  |||| ||| | |\n    |||||| |  |||| ||| || | |   | |    ||/--+-+----+--+-++-++---\\|   |   || ||    ||  ||| | | |||   |||| ||  ||  || ||| |  |||| |  | |  |||| ||| | |\n    |||||| |  |||| ||| || | |   | |    |||  | |    |  | || ||   ||   |   || ||    ||  ||| | | ||\\---++++-++--++--++-+++-+--++++-+--+-+--/||| ||| | |\n    |||||| |  |||| ||| |^ | |   | |    |||  | |    |  | || ||   ||   |   || ||    ||  |||/+-+-++----++++-++--++--++-+++\\|  |||| |  | |   ||| ||| | |\n  /-++++++-+--++++\\||| || | |   | |    |||  | |    |  | || ||   ||   |   \\+-++----++-<++/|| | ||    |||| ||  ||  || |||||  |||| |  | |   ||| ||| | |\n  | |||||| \\--++++++++-++-/ |   | |    ||| /+-+----+--+-++-++---++---+---\\| || /--++--++-++-+-++----++++-++--++--++-+++++--++++-+--+\\|   ||| ||| | |\n  | ||||||    |||||||| ||   |   | |    ||| || |    |  | || ||   ||   |   || || |  ||  || || | \\+----++++-++--++--++-++/||  |||| |  |||   ||| ||| | |\n  | ||||||    |||||||| ||   |   | | /--+++-++-+----+--+-++-++---++---+\\  || || |  \\+--++-++-+--+----++++-++--++--++-++-++--++++-+--+++---+++-+/| | |\n  | ||||||    |||||||| ||   |   | | |  ||| || |    | /+-++-++---++---++--++-++-+---+--++-++-+--+----++++-++--++--++-++-++--++++-+--+++---+++-+-+-+-+\\\n  | ||||||    |||||||| ||   |   | | |  ||| || |    | || \\+-++---++---++--++-++-+---+--++-++-+--+----++++-++--++--++-++-++--++++-+--+++---+++-+-/ | ||\n  | ||||||    \\+++++++-++---+---+-+-+--+++-++-+----+-++--+-++---++---++--++-++-+---+--++-++-+--+----+/|| ||  ||  || || ||  |||| |  |||   ||| |   | ||\n  | ||||||     ||||||| ||   |   | | |  ||| || |    | ||  | ||   ||   ||  || || |   |  || || |  |    | || ||  ||  || || ||  |||| |  |||   ||| |   | ||\n  | ||||||     ||||||| ||   |   | | |  \\++-++-+----+-++--+-++---++---++--++-++-+---+--++-++-+--+----+-++-++--++--++-++-++--++++-+--+++---+++-+---/ ||\n  | \\+++++-----+++++++-+/   |   \\-+-+---++-++-/    | ||  | ||   ||   ||  || || |   \\--++-++-+--+----+-++-++--++--/| || ||  |\\++-+--++/   ||| |     ||\n  |  |v|||/----+++++++-+----+--\\  | |   || ||      \\-++--+-++---++---++--++-++-+------++-++-+--+----+-++-++--++---+-++-++--+-++-+--/|    ||| |     ||\n  |  ||||||    \\++++++-+----+--+--+-+---++-++--------++--+-++---++---++--++-++-+------++-++-/  |    | || ||  ||   | || ||  | || |   |    ||| |     ||\n  |  ||||||   /-++++++-+----+--+--+-+---++-++--------++--+-++---++---++--++-++-+------++-++----+----+-++\\||  ||   | || ||  | || |   |    ||| |     ||\n  |  ||||||   | |||||| |    |  |  | |   \\+-++--------++--+-++---++---++--++-++-+------++-++----+----+-+++++--+/   | || ||  | || |   |    ||| |     ||\n  |  ||||||   | |||||| \\----+--+--+-+----+-++--------++--+-++---++---++--++-++-+------++-++----+----+-+++++--+----+-+/ ||  | || |   |    ||| |     ||\n  \\--++++++---+-++/|||      |  |  | |    | ||        ||  | ||   ||   ||  || || |   /--++-++----+----+-+++++--+----+-+--++\\ | || |   |    ||| |     ||\n     ||||||   | || |||      |  |  | |    | \\+--------++--+-++---++---++--/| || |   |  || ||    |    | |||||  |    | |  ||| | || |   |    ||| |     ||\n     \\+++++---+-++-+++------+--+--+-+----+--+--------++--+-++---++---++---+-+/ \\---+--++-++----+----+-+++++--+----+-+--+++-+-++-+---/    ||| |     ||\n      ||||| /-+-++-+++------+--+--+-+----+--+--------++--+-++---++---++---+-+------+--++-++----+----+-+++++--+\\   | |  ||| \\-++-+--------/|| |     ||\n      ||||| | | || |||      \\--+--+-+----+--+--------++--+-++---++---++---+-+->----+--++-++----+----+-++++/  ||   | |  |||   || |         || |     ||\n      ||||| | | || |||         |  | |    |  |        |\\--+-++---+/   ||/--+-+------+--++-++----+---\\| |\\++---++---+-/  |||   || |         || |     ||\n /----+++++-+-+-++\\|||         |  | |    \\--+--------+---+-++---/    |||  | |      |  || ||    |   || | |\\---++---+----+++---++-+---------++-+-----/|\n |    ||||| | | ||||||         |  | |       |        |   | ||        |||  | |      |  || ||    |   || | |    ||   |    |||   || |         || |      |\n |    ||||| | | |\\++++---------+--+-+-------+--------+---/ ||        |||  | |      |  || ||    |   || | |    ||   |    |||   || |         || |      |\n |    ||||| | | | ||||         |  | |       |        |     ||   /----+++--+-+------+--++-++----+---++-+-+----++---+----+++---++-+------\\  || |      |\n |    ||||| | | | ||||         |  | |       |        \\-----++---+----+++--+-+------+--++-++----+---++-+-+----++---+----+++---++-+------+--++-+------/\n |    ||||| | | | ||||         |  | \\-------+--------------++---+----+/|  | |      |  || ||    |   || | |    ||   |    ||| /-++-+------+-\\|| |\n |    ||||| | | | ||||         |  |         |              \\+---+----+-+--+-+------+--++-++----+---++-+-+----++---+----+++-+-+/ |      | ||| |\n |    ||||| | \\-+-++++---------+--+---------+---------------+---+----+-+--+-+------+--++-++----+---++-+-/    ||   |    ||| | |  |      | ||| |\n |    ||||| |   | |||\\---------+--+---------+---------------+---+----+-+--+-+------+--++-++----+---++-+------/|   |    ||| | |  |      | ||| |\n |/---+++++-+---+-+++-\\        |  |     /---+---------------+---+----+-+--+-+------+--++-++----+---++-+-------+---+----+++-+-+--+------+\\||| |\n \\+---+++++-+---+-/|| |        |  |     |   |               |/--+----+-+--+-+------+--++-++----+---++-+-----\\ |   |    ||| | |  |      ||||| |\n  |   \\++++-+---+--++-+--------+--+-----+---+---------------++--+----+-+--+-+------+--+/ ||    |   || |     | |   |    ||| | |  \\------++++/ |\n  |    |||| |   |  || |        |  |     |   |               ||  |    | |  \\-+------+--+--++----/   || |     | |   |    ||| | |         ||||  |\n  |    |||| |   |  || |        |  |     v   |               ||  |    | |    |      |  |  \\+--------++-+-----+-+---+----/|| | |         ||||  |\n  |    ||\\+-+---+--++-+--------+--/     |   |               ||  |    | |    |      |  |   |        |\\-+-----+-+---/     || | |         ||||  |\n  |    || | |   |  \\+-+--------+--------+---+---------------++--+----+-+----+------+--+---+--------+--+----<+-+---------++-+-/         ||||  |\n  |    || | |   |   \\-+--------+--------+---+---------------++--+----+-+----+------+--/   |        |  |     | |         || \\-----------++/|  |\n  |    \\+-+-+---+-----+--------+--------+---+---------------++--+----+-+----+------+------/        |  |     | |         ||             || |  |\n  |     | | |   |     |        |        \\---+---------------++--+----+-+----+------+---------------+--+-----+-+---------++-------------+/ |  |\n  |     | | |   |     |        |            |               ||  |    | |    |      |               |  |     | |         ||             |  |  |\n  |     | | \\---+-----+--------+------------+---------------++--+----+-+----+------+---------------+--+-----+-/         ||             |  |  |\n  |     | |     \\-----+--------+------------+---------------++--+----+-+----/      |               |  |     |           ||             |  |  |\n  |     | |           |        |            |    /----------++--+----+-+-----------+---------------+--+-----+-----------++----\\        |  |  |\n  |     | |           |        |            |    |          \\+--+----+-+-----------+---------------+--+-----+-----------/|    |        |  |  |\n  \\-----+-+-----------/        |            |    |           \\--+----+-+-----------+---------------+--+-----/            |    |        |  |  |\n        | |                    |            \\----+--------------+----+-+-----------+---------------+--+------------------+----+--------+--/  |\n        | |                    |                 |              |    | |           \\---------------+--+------------------/    |        |     |\n        \\-+--------------------+-----------------+--------------+----/ |                           |  |                       |        |     |\n          |                    |                 |              |      \\---------------------------/  |                       |        |     |\n          \\--------------------/                 |              \\-------------------------------------+-----------------------+--------/     |\n                                                 |                                                    \\-----------------------+--------------/\n                                                 \\----------------------------------------------------------------------------/\n"
